<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntDash | AI ì£¼ì‹ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        :root { --bg: #f4f7fa; --card: #ffffff; --primary: #2962ff; --text: #1e293b; --red: #f44336; --blue: #2196f3; --gray: #64748b; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        header { background: #0f172a; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .container { display: grid; grid-template-columns: 280px 1fr 320px; gap: 24px; padding: 24px; max-width: 1500px; margin: auto; }

        .card { background: var(--card); border-radius: 16px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 24px; border: 1px solid rgba(0,0,0,0.03); }
        h3 { margin-top: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; margin-bottom: 20px; color: #334155; }

        /* ì§€ìˆ˜ ìŠ¤íƒ€ì¼ */
        .index-item { display: flex; justify-content: space-between; margin-bottom: 18px; padding: 12px; background: #f8fafc; border-radius: 10px; font-size: 0.95rem; }
        
        /* ë‰´ìŠ¤ ìŠ¤íƒ€ì¼ */
        .news-item { margin-bottom: 16px; padding: 16px; border-radius: 12px; border: 1px solid #f1f5f9; cursor: pointer; transition: all 0.2s; }
        .news-item:hover { background: #f8fafc; transform: translateY(-2px); border-color: var(--primary); }
        .news-tag { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; text-transform: uppercase; }
        .news-title { font-weight: 700; margin: 10px 0; font-size: 1.05rem; line-height: 1.4; }
        .news-desc { font-size: 0.9rem; color: #64748b; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* ê³„ì‚°ê¸° ìŠ¤íƒ€ì¼ */
        .input-group { margin-bottom: 15px; }
        label { font-size: 0.85rem; color: var(--gray); font-weight: 600; }
        input { width: 100%; padding: 12px; margin-top: 6px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
        .btn-calc { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        .btn-calc:hover { background: #1e40af; }
        .calc-result { margin-top: 20px; padding: 15px; background: #f1f5f9; border-radius: 8px; display: none; }

        @media (max-width: 1100px) { .container { grid-template-columns: 1fr; } .container aside, .container section { display: none; } }
    </style>
</head>
<body>

<header>
    <div style="font-size: 1.5rem; font-weight: 900; letter-spacing: -0.5px;">ğŸœ AntDash <span style="font-weight: 300; font-size: 0.9rem; margin-left: 10px; opacity: 0.7;">Beta</span></div>
    <div id="realtime-clock" style="font-family: monospace; font-size: 1rem;">--:--:--</div>
</header>

<div class="container">
    <aside>
        <div class="card">
            <h3>ğŸ“Š ì£¼ìš” ì§€ìˆ˜ (ì‹¤ì‹œê°„)</h3>
            <div class="index-item">
                <span>ì½”ìŠ¤í”¼</span> 
                <span id="kospi-val" style="font-weight:bold; color:#999;">ë¡œë”©ì¤‘...</span>
            </div>
            <div class="index-item">
                <span>ì½”ìŠ¤ë‹¥</span> 
                <span id="kosdaq-val" style="font-weight:bold; color:#999;">ë¡œë”©ì¤‘...</span>
            </div>
            <div class="index-item">
                <span>ë‚˜ìŠ¤ë‹¥ ì„ ë¬¼</span> 
                <span id="nasdaq-val" style="font-weight:bold; color:#999;">ë¡œë”©ì¤‘...</span>
            </div>
            <div class="index-item">
                <span>ì›/ë‹¬ëŸ¬ í™˜ìœ¨</span> 
                <span id="exchange-val" style="font-weight:bold; color:#999;">ë¡œë”©ì¤‘...</span>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ”¥ ì˜¤ëŠ˜ì˜ í…Œë§ˆ</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <span style="background: #eff6ff; color: #1e40af; padding: 5px 10px; border-radius: 6px; font-size: 0.85rem;">#ë°˜ë„ì²´</span>
                <span style="background: #fef2f2; color: #991b1b; padding: 5px 10px; border-radius: 6px; font-size: 0.85rem;">#AI</span>
                <span style="background: #f0fdf4; color: #166534; padding: 5px 10px; border-radius: 6px; font-size: 0.85rem;">#2ì°¨ì „ì§€</span>
            </div>
        </div>
    </aside>

    <main>
        <div class="card">
            <h3>ğŸ—ï¸ AI ë‰´ìŠ¤ ë¶„ì„ (ì‹¤ì‹œê°„)</h3>
            <div id="news-list">
                <p style="text-align:center; padding: 20px; color: var(--gray);">
                    ğŸ¤– AIê°€ ìµœì‹  ë‰´ìŠ¤ë¥¼ ì½ê³  ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...<br>
                    (ì•½ 3~5ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤)
                </p>
            </div>
        </div>
    </main>

    <section>
        <div class="card">
            <h3>ğŸ§® ë¬¼íƒ€ê¸° ê³„ì‚°ê¸°</h3>
            <div class="input-group">
                <label>ê¸°ì¡´ í‰ë‹¨/ìˆ˜ëŸ‰</label>
                <div style="display: flex; gap: 5px;">
                    <input type="number" id="p1" placeholder="ë‹¨ê°€">
                    <input type="number" id="q1" placeholder="ìˆ˜ëŸ‰">
                </div>
            </div>
            <div class="input-group">
                <label>ì¶”ê°€ ë§¤ìˆ˜ ë‹¨ê°€/ìˆ˜ëŸ‰</label>
                <div style="display: flex; gap: 5px;">
                    <input type="number" id="p2" placeholder="ë‹¨ê°€">
                    <input type="number" id="q2" placeholder="ìˆ˜ëŸ‰">
                </div>
            </div>
            <button class="btn-calc" onclick="calculateAverage()">í‰ë‹¨ê°€ ê³„ì‚°í•˜ê¸°</button>
            <div id="calc-result" class="calc-result">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;"><span>ìµœì¢… í‰ë‹¨:</span><strong id="res-price">0ì›</strong></div>
                <div style="display: flex; justify-content: space-between;"><span>ìµœì¢… ìˆ˜ëŸ‰:</span><strong id="res-qty">0ì£¼</strong></div>
            </div>
        </div>
    </section>
</div>

<script>
    // ì‹œê³„ ë™ì‘
    setInterval(() => {
        document.getElementById('realtime-clock').innerText = new Date().toLocaleString();
    }, 1000);

    // ==========================================
    // 1. ë‰´ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (api/news.js í˜¸ì¶œ)
    // ==========================================
    async function fetchNews() {
        const list = document.getElementById('news-list');
        try {
            const response = await fetch('/api/news');
            if (!response.ok) throw new Error('Network response was not ok');
            const newsData = await response.json();

            list.innerHTML = newsData.map(news => {
                let color = "#64748b"; 
                let icon = "âšª";
                let label = news.sentiment || "ì¤‘ë¦½";
                
                if(label.includes("í˜¸ì¬")) { color = "#2563eb"; icon = "ğŸ”µ"; }
                else if(label.includes("ì•…ì¬")) { color = "#dc2626"; icon = "ğŸ”´"; }

                return `
                    <div class="news-item" onclick="window.open('${news.link}', '_blank')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="news-tag" style="background: ${color}; color: white;">AI: ${label} ${icon}</span>
                            <span style="font-size: 0.8rem; color: var(--gray);">${news.date}</span>
                        </div>
                        <div class="news-title">${news.title}</div>
                        <div class="news-desc">${news.description}</div>
                    </div>
                `;
            }).join('');
        } catch (e) {
            console.error(e);
            list.innerHTML = '<p style="text-align:center; color:red;">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
        }
    }

    // ==========================================
    // 2. ì£¼ìš” ì§€ìˆ˜ ê°€ì ¸ì˜¤ê¸° (api/indices.js í˜¸ì¶œ) - [ì‹ ê·œ]
    // ==========================================
    async function fetchIndices() {
        try {
            const res = await fetch('/api/indices');
            if(!res.ok) throw new Error("ì§€ìˆ˜ API í˜¸ì¶œ ì‹¤íŒ¨");
            const data = await res.json();

            updateIndex('kospi-val', data.kospi);
            updateIndex('kosdaq-val', data.kosdaq);
            updateIndex('nasdaq-val', data.nasdaq);
            updateIndex('exchange-val', data.exchange);

        } catch (e) {
            console.error("ì§€ìˆ˜ ë¡œë”© ì‹¤íŒ¨", e);
            // ì—ëŸ¬ ì‹œ 'ì‹¤íŒ¨'ë¼ê³  í‘œì‹œ
            ['kospi-val', 'kosdaq-val', 'nasdaq-val', 'exchange-val'].forEach(id => {
                document.getElementById(id).innerText = "ë¡œë”© ì‹¤íŒ¨";
            });
        }
    }

    function updateIndex(elementId, info) {
        if(!info) return;
        const el = document.getElementById(elementId);
        const icon = info.isUp ? 'â–²' : 'â–¼';
        const color = info.isUp ? '#f44336' : '#2196f3'; // ìƒìŠ¹ ë¹¨ê°•, í•˜ë½ íŒŒë‘
        
        el.innerText = `${info.price} ${icon} (${info.percent}%)`;
        el.style.color = color;
    }

    // ==========================================
    // 3. ë¬¼íƒ€ê¸° ê³„ì‚°ê¸° ë¡œì§
    // ==========================================
    function calculateAverage() {
        const p1 = parseFloat(document.getElementById('p1').value) || 0;
        const q1 = parseFloat(document.getElementById('q1').value) || 0;
        const p2 = parseFloat(document.getElementById('p2').value) || 0;
        const q2 = parseFloat(document.getElementById('q2').value) || 0;
        if((p1*q1 + p2*q2) === 0) return alert("ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        const totalAmt = (p1 * q1) + (p2 * q2);
        const totalQty = q1 + q2;
        const avg = totalAmt / totalQty;
        document.getElementById('res-price').innerText = Math.round(avg).toLocaleString() + "ì›";
        document.getElementById('res-qty').innerText = totalQty.toLocaleString() + "ì£¼";
        document.getElementById('calc-result').style.display = 'block';
    }

    // ì‚¬ì´íŠ¸ ì¼œì§€ë©´ ì‹¤í–‰
    window.onload = function() {
        fetchNews();    // ë‰´ìŠ¤ ì‹¤í–‰
        fetchIndices(); // ì§€ìˆ˜ ì‹¤í–‰
    };
</script>
</body>
</html>
